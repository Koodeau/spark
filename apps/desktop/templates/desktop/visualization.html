{% extends "desktop/base.html" %}
{% set title = _('Global Visualizer') %}
{% set body_id = 'visualizer' %}
{% set scripts = ('jquery-ui', 'desktop', 'raphael', 'visualization') %}
{% set stylesheets = ('visualization',) %}
{% set user_shares = _("{username}'s shares")|f(username=username) %}

{% block content %}
	<div id="wrapper">
		<div id="masthead">
			<h1>
				{{ _('Spark Global Visualizer') }}<br>
				<span>{{ _('powered by Firefox for mobile') }}</span>
			</h1>
			<ul id="main-menu">
			    {% if logged_in %}
			    <li class="logged-in">
			        <a id="show-your-shares">{{ _('Show your shares') }}</a>
			        <a class="hidden" id="show-everyone">{{ _("Show everyone's shares") }}</a>
			    {% else %}
			    <li class="logged-out">{{ _('Show your shares') }}
					<span><a id="sign-in-first" class="popup-trigger">{{ _('Sign in first >') }}</a></span>
			    {% endif %}
			    </li>
				{# L10n: Action verb placed next to a dropdown list of cities, allowing to filter the visualization on a specific city. #}
				<li>{{ _('Focus on location') }}
                    <form id="dropdown">
                        <select id="cities-list" name="cities">
                            <option value="-1">{{ _('Everywhere') }}</option>
                            {% for position, city in cities %}
                            <option value="{{ position }}">{{ city }}</option>
                            {% endfor %}
                        </select>
                    </form>
				</li>
			</ul>
		</div> <!-- end masthead -->

	    <div id="timelapse" class="">
	       <div id="dates" class="">
	           <span id="start-date">--:--:-- --:--:--</span>
	           <span id="current-date">--:--:-- --:--:--</span>
	       </div>
	       <div id="time-wrapper">
               <span id="current-time"></span>
	       </div>
	       <div id="play-pause">
	           {# L10n: Action verb on a button to start playing the global visualization. #}
    	       <span id="play">{{ _('Play time-lapse') }}</span>
	           {# L10n: Action verb on a button to pause the global visualization. #}
    	       <span id="pause">{{ _('Pause time-lapse') }}</span>
	       </div>
	    </div>
	    
		<div id="content">
            <div id="visualization">
                {% set username = request.user.username %}
    		    <span id="your-shares-info">{{ username }}'s shares</span>
    		    <span id="focus-info"></span>
            </div>
        </div>
        <div id="tooltip">
           <div id="tooltip-arrow"></div>
           <span></span>
        </div>
	    
		<div id="zoom-wrapper">
		    <div id="zoom-out" class="off"></div>
		  	<div id="zoom"></div>
		    <div id="zoom-in"></div>
		</div>
		
		{% include 'desktop/popups/logged-out.html' %}
    	<div id="mask"></div>
		
	</div> <!-- end wrapper -->
{% endblock %}

{% block script %}
<script>
var cities = {{ citylist|safe }};

var globalHistory = [[], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [[9, 117, 1]], [], [], [[9, 9, 2]], [[9, 9, 5]], [], [], [[9, 9, 6]], [], [], [[9, 117, 2]], [[9, 55, 1], [55, 117, 1]], [[11, 63, 1]], [[163, 163, 1]], [], [], [], [], [[299, 302, 1], [299, 299, 1], [9, 189, 1]], [], [], [], [], [], [[45, 125, 1], [9, 125, 1], [34, 34, 1]], [[300, 300, 2], [117, 122, 1]], [], [], [], [], [[117, 117, 1]], [], [], [[9, 215, 1]], [], [], [], [], [[9, 63, 1]], [], [[171, 171, 1]], [[45, 117, 1], [271, 271, 1]], [], [[106, 116, 1]], [], [[56, 56, 2]], [[56, 56, 3]], [], [[9, 56, 1]], [[56, 56, 4]], [[163, 163, 2]], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [[109, 128, 1]], [], [], [], [], [], [], [], [[114, 114, 1]], [], [[74, 74, 1]], [], [], [], [], [], [[114, 183, 1]], [], [], [], [], [[45, 45, 1], [37, 162, 1]], [], [], [], [[50, 50, 1]], [], [], [], [], [], [[39, 39, 1]], [], [[56, 114, 1], [56, 147, 1]], [[56, 215, 1]], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [[122, 122, 1]], [], [], [], [], [], [], [], [], [], [[9, 9, 7], [30, 30, 1]], [[9, 9, 8]], [[63, 63, 1]], [[56, 258, 1]], [[30, 30, 2]], [[9, 37, 1]], [], [], [], [[125, 125, 1]], [], [], [[11, 45, 1]], [[11, 147, 1], [45, 300, 1]], [], [], [], [], [[45, 125, 2]], [], [[37, 63, 1]], [], [], [], [], [], [], [[45, 122, 1]], [], [], [], [], [], [], [[45, 104, 1]], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [[8, 114, 1]], [], [], [], [], [], [], [], [], [], [], [], [], [], [[1, 126, 1], [15, 126, 1]], [[55, 126, 1]], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [[302, 307, 1]], [], [], [], [], [], [], [], [], [], [], [], [], [[56, 56, 5]], [], [[12, 12, 1]], [], [], [], [], [], []];
var globalFinalShares = [[9, 117, 2], [9, 9, 8], [9, 55, 1], [55, 117, 1], [11, 63, 1], [163, 163, 2], [299, 302, 1], [299, 299, 1], [9, 189, 1], [45, 125, 2], [9, 125, 1], [34, 34, 1], [300, 300, 2], [117, 122, 1], [117, 117, 1], [9, 215, 1], [9, 63, 1], [171, 171, 1], [45, 117, 1], [271, 271, 1], [106, 116, 1], [56, 56, 5], [9, 56, 1], [109, 128, 1], [114, 114, 1], [74, 74, 1], [114, 183, 1], [45, 45, 1], [37, 162, 1], [50, 50, 1], [39, 39, 1], [56, 114, 1], [56, 147, 1], [56, 215, 1], [122, 122, 1], [30, 30, 2], [63, 63, 1], [56, 258, 1], [9, 37, 1], [125, 125, 1], [11, 45, 1], [11, 147, 1], [45, 300, 1], [37, 63, 1], [45, 122, 1], [45, 104, 1], [8, 114, 1], [1, 126, 1], [15, 126, 1], [55, 126, 1], [302, 307, 1], [12, 12, 1]];

{% if logged_in %}
var userHistory = {{ user_history }};
var userFinalShares = {{ user_final_history }};
{% endif %}

var shareHistory = globalHistory;
var finalShares = globalFinalShares;

var startingDate = {{ starting_date }},
    endDate = new Date();

$(document).ready(function() {
    enableRaphaelGroups();
    
    initState();
    initCityList();
    initShapes();
    initUI();

    drawFinalState();
});
</script>
{% endblock %}
